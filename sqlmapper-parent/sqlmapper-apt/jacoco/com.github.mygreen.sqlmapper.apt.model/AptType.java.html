<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ja"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AptType.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sqlmapper-apt</a> &gt; <a href="index.source.html" class="el_package">com.github.mygreen.sqlmapper.apt.model</a> &gt; <span class="el_source">AptType.java</span></div><h1>AptType.java</h1><pre class="source lang-java linenums">package com.github.mygreen.sqlmapper.apt.model;

import java.util.ArrayList;
import java.util.List;
import java.util.NoSuchElementException;
import java.util.Optional;

import javax.lang.model.element.Element;
import javax.lang.model.element.ElementKind;
import javax.lang.model.element.Modifier;
import javax.lang.model.element.TypeElement;
import javax.lang.model.type.ArrayType;
import javax.lang.model.type.PrimitiveType;
import javax.lang.model.type.TypeKind;
import javax.lang.model.type.TypeMirror;

import com.squareup.javapoet.ClassName;
import com.squareup.javapoet.TypeName;

import lombok.RequiredArgsConstructor;
import lombok.Setter;

/**
 * APTで処理する際のクラスタイプに対するユーティリティクラス。
 *
 *
 * @author T.TSUCHIE
 *
 */
@RequiredArgsConstructor
public class AptType {

    /**
     * APT上のクラスタイプ
     */
    private final TypeMirror typeMirror;

    /**
     * APTのタイプ要素
     */
    private final Optional&lt;Element&gt; typeElement;

    /**
     * 継承しているクラス情報
     */
    @Setter
    private List&lt;TypeMirror&gt; superTypes = new ArrayList&lt;TypeMirror&gt;();

    /**
     * 静的なクラス(static class)か判定します。
     * @return 静的なクラス(static class)のとき{@literal true}を返します。
     */
    public boolean isStaticInnerClass() {

<span class="pc bpc" id="L55" title="1 of 2 branches missed.">        if(typeElement.isEmpty()) {</span>
<span class="nc" id="L56">            return false;</span>
        }

<span class="fc" id="L59">        final Element element = typeElement.get();</span>

        // クラスかどうか
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">        if(element.getKind() != ElementKind.CLASS) {</span>
<span class="nc" id="L63">            return false;</span>
        }

        // staticかどうか
<span class="fc bfc" id="L67" title="All 2 branches covered.">        if(!element.getModifiers().contains(Modifier.STATIC)) {</span>
<span class="fc" id="L68">            return false;</span>
        }

<span class="fc" id="L71">        return true;</span>

    }

    /**
     * 抽象クラス(static class)か判定します。
     * @return 抽象クラスのとき{@literal true}を返します。
     */
    public boolean isAbstract() {

<span class="pc bpc" id="L81" title="1 of 2 branches missed.">        if(typeElement.isEmpty()) {</span>
<span class="nc" id="L82">            return false;</span>
        }

<span class="fc" id="L85">        final Element element = typeElement.get();</span>

        // クラスかどうか
<span class="pc bpc" id="L88" title="1 of 2 branches missed.">        if(element.getKind() != ElementKind.CLASS) {</span>
<span class="nc" id="L89">            return false;</span>
        }

        // abstractかどうか
<span class="pc bpc" id="L93" title="1 of 2 branches missed.">        if(!element.getModifiers().contains(Modifier.ABSTRACT)) {</span>
<span class="fc" id="L94">            return false;</span>
        }

<span class="nc" id="L97">        return true;</span>
    }

    /**
     * 配列型かどうか判定します。
     * @return 配列型のとき、{@literal true} を返す。
     */
    public boolean isArray() {
<span class="nc" id="L105">        return (typeMirror instanceof ArrayType);</span>
    }

    /**
     * 列挙型かどうか判定します。
     * @return 列挙型のとき、{@literal true} を返す。
     */
    public boolean isEnum() {

<span class="nc" id="L114">        return typeElement</span>
<span class="nc" id="L115">                .map(t -&gt; t.getKind())</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">                .map(k -&gt; k == ElementKind.ENUM)</span>
<span class="nc" id="L117">                .orElse(false);</span>
    }

    /**
     * プリミティブ型かどうか判定します。
     * @return プリミティブ型のとき、{@literal true} を返す。
     */
    public boolean isPrimitive() {
<span class="fc" id="L125">        return (typeMirror instanceof PrimitiveType);</span>
    }

    /**
     * プリミティブ型の数値かどうか判定します。
     * @return プリミティブ型の数値とき、{@literal true} を返す。
     */
    public boolean isPrimitiveNumber() {
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">        if(!isPrimitive()) {</span>
<span class="nc" id="L134">            return false;</span>
        }

<span class="pc bpc" id="L137" title="1 of 2 branches missed.">        switch(typeMirror.getKind()) {</span>
            case SHORT:
            case INT:
            case LONG:
            case FLOAT:
            case DOUBLE:
<span class="fc" id="L143">                return true;</span>
            default:
<span class="nc" id="L145">                return false;</span>
        }
    }

    /**
     * プリミティブ型のbooleanかどうか判定します。
     * @return プリミティブ型のbooleanとき、{@literal true} を返す。
     */
    public boolean isPrimitiveBoolean() {
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if(!isPrimitive()) {</span>
<span class="nc" id="L155">            return false;</span>
        }

<span class="nc bnc" id="L158" title="All 2 branches missed.">        return typeMirror.getKind() == TypeKind.BOOLEAN;</span>
    }

    /**
     * このクラスが指定したクラスを継承しているかどうか判定します。
     * @param targetClass 継承するクラス情報
     * @return 指定したクラスを継承しているとき、{@literal true} を返す。
     */
    public boolean isInheritanceOf(final Class&lt;?&gt; targetClass) {

<span class="fc" id="L168">        final String targetClassName = targetClass.getCanonicalName();</span>

<span class="fc bfc" id="L170" title="All 2 branches covered.">        if(getCanonicalName().equals(targetClassName)) {</span>
<span class="fc" id="L171">            return true;</span>
        }

<span class="fc bfc" id="L174" title="All 2 branches covered.">        for(TypeMirror superType : superTypes) {</span>
<span class="fc bfc" id="L175" title="All 2 branches covered.">            if(superType.toString().equals(targetClassName)) {</span>
<span class="fc" id="L176">                return true;</span>
            }
<span class="fc" id="L178">        }</span>

<span class="fc" id="L180">        return false;</span>

    }

    /**
     * FQNのクラス名を取得します。
     * @return パッケージ名付きのクラス名
     */
    public String getCanonicalName() {
<span class="fc" id="L189">        return typeMirror.toString();</span>
    }

    /**
     * パッケージ名を除いたクラス名を取得します。
     * @return パッケージ名を除いたクラス
     */
    public String getSimpleName() {

<span class="fc" id="L198">        String name = typeMirror.toString();</span>
<span class="fc" id="L199">        int index = name.lastIndexOf(&quot;.&quot;);</span>
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">        if(index &gt;= 0) {</span>
<span class="fc" id="L201">            return name.substring(index+1);</span>
        }

<span class="nc" id="L204">        return name;</span>
    }

    /**
     * JavaPoetの{@link ClassName}に変換します。
     * @return クラス名情報。
     * @throws NoSuchElementException クラスタイプでない場合にスローされます。
     */
    public ClassName asClassName() {
<span class="fc" id="L213">        return ClassName.get((TypeElement)typeElement.orElseThrow());</span>
    }

    /**
     * JavaPoetのタイプ情報を取得する。
     * ただし、プリミティブ型のときはラッパークラスを取得する。
     * @return JavaPoetのタイプ情報。
     */
    public TypeName getWrapperTypeName() {

<span class="fc bfc" id="L223" title="All 2 branches covered.">        if(isPrimitive()) {</span>
            // プリミティブ型のときはラッパー方に変える
<span class="fc" id="L225">            return TypeName.get(typeMirror).box();</span>
        }

<span class="fc" id="L228">        return TypeName.get(typeMirror);</span>

    }

    /**
     * JavaPoetのタイプ情報を取得する。
     * @return JavaPoetのタイプ情報。
     */
    public TypeName getTypeName() {
<span class="nc" id="L237">        return TypeName.get(typeMirror);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>