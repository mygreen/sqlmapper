= 検索

== 複数件検索

SQLを使って、複数件検索をする場合は、`selectBySql(..)` と `getResultList()` を組み合わせます。

[source,java]
----
SqlTemplateContext templateContext = new MapSqlTemplateContext(
        Map.of("salary", nwe BigDecimal(2000)));

List<Employee> results = sqlMapper.selectBySql(
            Employee.class, 
            "select * from employee where salary >= /*salary*/", 
            templateContext)
        .getResultList();
----

== 1件検索

SQLを使って1件検索をする場合は、 `selectBySql(...)` と `getSingleResult()` を組み合わせます。

* 1件も見つからない、または、2件以上見つかった場合、Springの例外 `IncorrectResultSizeDataAccessException` がスローされます。

[source,java]
----
SqlTemplateContext templateContext = new MapSqlTemplateContext(
        Map.of("id", 10));

Employee result = sqlMapper.sqlMapper.selectBySql(
            Employee.class, 
            "select * from employee where id = /*id*/", 
            templateContext)
        .getSingleResult();
----

0件/複数件見つかったときに例外をスローされないようにするには、`getOptionalResult()` を使用します。

* 戻り値を `java.util.Optinal` で受け取ることができます。

[source,java]
----
SqlTemplateContext templateContext = new MapSqlTemplateContext(
        Map.of("id", 10));

Optional<Employee> result = sqlMapper.sqlMapper.selectBySql(
            Employee.class, 
            "select * from employee where id = /*id*/", 
            templateContext)
        .getOptionalResult();
----

== Streamによる検索

検索結果を多くの行を返すため、`List` でまとめて受け取ることが困難な場合は、`getResultStream()` を使用します。

.検索結果の1件目を取得する
[source,java]
----
SqlTemplateContext templateContext = new MapSqlTemplateContext(
        Map.of("salary", nwe BigDecimal(2000)));

List<Employee> results = sqlMapper.selectBySql(
            Employee.class, 
            "select * from employee where salary >= /*salary*/", 
            templateContext)
        .getResultStream()
        .findFirst()
        .get()
----

.検索結果をイテレーションする
[source,java]
----
SqlTemplateContext templateContext = new MapSqlTemplateContext(
        Map.of("salary", nwe BigDecimal(2000)));

List<Employee> results = sqlMapper.selectBySql(
            Employee.class, 
            "select * from employee where salary >= /*salary*/", 
            templateContext)
        .getResultStream()
        .forEach({
            //TODO:任意の処理
        })
----

== 検索結果の行数取得

`SELECT COUNT(*) ～` による検索結果の行数を取得するには、`getCountBySql(...)` を使用します。

[source,java]
----
SqlTemplateContext templateContext = new MapSqlTemplateContext(
        Map.of("salary", nwe BigDecimal(2000)));

long count = sqlMapper.selectBySql(
            Employee.class, 
            "select * from employee where salary >= /*salary*/", 
            templateContext)
            getCount();
----



